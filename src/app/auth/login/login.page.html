<ion-content [fullscreen]="false">
  
  <div class="splash-container" *ngIf="showSplash">
    <div class="splash-logo-wrapper">
      <img
        src="https://api.builder.io/api/v1/image/assets/TEMP/2d5826d58c22c1d10e86105e94fc8c7642f220f5?width=476"
        alt="ARS Green Steel Logo"
        class="company-logo"
      />
    </div>
    
    <div class="splash-illustration">
      <img src="assets/factory_illustration.png" alt="Factory Illustration" class="illustration-img" onerror="this.src='https://placehold.co/300x200/e3f2fd/1064a3?text=Factory+Illustration'"/>
    </div>

    <div class="splash-loader">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
    </div>
  </div>


  <div class="login-container" *ngIf="!showSplash" [class.has-keypad]="showKeypad">
    
    <header class="header-section">
      <div class="back-button-wrapper" *ngIf="isError" (click)="goToThirdScreen()">
        <ion-icon name="arrow-back-outline" class="back-icon"></ion-icon>
      </div>
      
      <div class="logo-wrapper">
        <img
          src="https://api.builder.io/api/v1/image/assets/TEMP/2d5826d58c22c1d10e86105e94fc8c7642f220f5?width=476"
          alt="ARS Green Steel Logo"
          class="company-logo"
        />
      </div>
    </header>

    <main class="form-content">
      
      <div class="error-banner" *ngIf="isError">
        <ion-icon name="close-circle" class="error-icon-badge"></ion-icon>
        <span class="error-text">Invalid Employee id or password</span>
      </div>

      <div class="title-section">
        <h2 class="login-title">Welcome!</h2>
        <p class="subtitle">
          Enter your Employee ID and Password
        </p>
      </div>

      <form class="login-form" (submit)="$event.preventDefault()">
        
        <div class="input-field" 
             [class.active-focus]="showKeypad && !isError"
             [class.error-state]="isError">
          
          <div class="phone-icon-wrapper">
             <ion-icon name="phone-portrait-outline" class="input-icon"></ion-icon>
          </div>
          
          <div class="input-wrapper">
            <input
              type="text"
              name="employeeId"
              [(ngModel)]="employeeId"
              class="mobile-input"
              placeholder="Employee ID"
              (focus)="activeField = 'employeeId'; showKeypad = true"
            />
          </div>
        </div>

        <div class="input-field" 
          [class.active-focus]="showKeypad && !isError"
          [class.error-state]="isError">
          <div class="phone-icon-wrapper">
            <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
          </div>

          <div class="input-wrapper">
            <input
              type="password"
              name="password"
              [(ngModel)]="password"
              class="mobile-input"
              placeholder="Password"
              (focus)="activeField = 'password'; showKeypad = true"
            />
          </div>
        </div>

        <!-- GPS status + Forgot Password row -->
          <div class="helper-row">

            <!-- GPS Inactive (LEFT) -->
            <div class="gps-status">
              <ion-icon name="location-outline" class="gps-icon"></ion-icon>
              <span class="gps-text">
                GPS Inactive<span class="gps-star">*</span>
              </span>
            </div>

            <!-- Forgot Password (RIGHT) -->
            <button type="button" class="forgot-password-btn" (click)="openForgotPassword()">
              Forgot Password?
            </button>

          </div>

        <div class="button-container">
          <button 
            type="button" 
            class="otp-button" 
            (click)="login()"
            [disabled]="isLoading">
            <span class="button-text">{{ isLoading ? 'Logging in...' : 'Login' }}</span>
          </button>
        </div>
        <!-- Login with OTP -->
        <div class="login-otp-wrapper">
          <button type="button" class="login-otp-btn" (click)="openLoginMobile()">
            Login with OTP
          </button>
        </div>
        
      </form>
    </main>

     <section class="virtual-keypad" *ngIf="showKeypad">
        
        <div class="keypad-toolbar">
            <div class="toolbar-left">
                <ion-icon name="chevron-back" class="toolbar-icon"></ion-icon>
            </div>
            <div class="toolbar-center">
                <span class="gif-text">GIF</span>
                <ion-icon name="settings-sharp" class="toolbar-icon"></ion-icon>
                <ion-icon name="language" class="toolbar-icon"></ion-icon>
                <ion-icon name="happy-outline" class="toolbar-icon"></ion-icon>
                <ion-icon name="ellipsis-horizontal" class="toolbar-icon"></ion-icon>
            </div>
            <div class="toolbar-right">
                <ion-icon name="mic" class="toolbar-icon"></ion-icon>
            </div>
        </div>

        <div class="keypad-grid">
            <div class="keypad-row">
                 <button class="key-btn" *ngFor="let k of currentKeys[0]" (click)="onKeyPress(k)">
                    <span class="num">{{ k }}</span>
                  </button>
                </div>

                <!-- ROW 2 -->
                <div class="keypad-row">
                  <button class="key-btn" *ngFor="let k of currentKeys[1]" (click)="onKeyPress(k)">
                    <span class="num">{{ k }}</span>
                  </button>
                </div>

                <!-- ROW 3 -->
                <div class="keypad-row">
                  <button class="key-btn" *ngFor="let k of currentKeys[2]" (click)="onKeyPress(k)">
                    <span class="num">{{ k }}</span>
                  </button>
            </div>
            <div class="keypad-row bottom-row">
                <!-- TOGGLE ABC / 123 -->
                <button class="key-btn action-btn" (click)="toggleKeyboard()">
                  <span class="num">{{ keyboardMode === 'abc' ? '123' : 'ABC' }}</span>
                </button>

                <!-- SPACE / 0 -->
                <button class="key-btn" (click)="onKeyPress(' ')">
                  <span class="num">Space</span>
                </button>

                <!-- BACKSPACE -->
                <button class="key-btn action-btn" (click)="onKeyPress('BACKSPACE')">
                  <ion-icon name="backspace-outline" class="action-icon"></ion-icon>
                </button>
            </div>
        </div>
    </section>

  </div>
</ion-content>